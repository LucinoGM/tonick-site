<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jogo de Carro 2D</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: sans-serif; background: #222; color: #fff; }
    canvas { background: #444; display: block; margin: 0 auto; border: 4px solid #fff; }
    .menu {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      text-align: center;
    }
    .menu button {
      padding: 10px 20px; margin: 10px; font-size: 18px;
      cursor: pointer; background: #00c896; border: none; color: white;
    }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="menu" id="menu">
    <h1>Jogo de Carro 2D</h1>
    <p>Escolha o modo de jogo:</p>
    <button onclick="startGame(1)">1 Jogador</button>
    <button onclick="startGame(2)">2 Jogadores</button>
  </div>
  <canvas id="game" width="600" height="800" class="hidden"></canvas>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let player1 = null, player2 = null;
    let obstacles = [];
    let keys = {};
    let gameRunning = false;
    let score = 0;
    let difficulty = 2;
    let mode = 1;
    let slowTimer = 0, slideTimer = 0;
    let gameOver = false;

    const carWidth = 40, carHeight = 60;

    function startGame(selectedMode) {
      mode = selectedMode;
      document.getElementById("menu").classList.add("hidden");
      canvas.classList.remove("hidden");

      player1 = { x: 200, y: 700, color: "lime", speed: 5 };
      if (mode === 2) player2 = { x: 360, y: 700, color: "cyan", speed: 5 };
      obstacles = [];
      keys = {};
      score = 0;
      difficulty = 2;
      gameRunning = true;
      gameOver = false;
      loop();
    }

    function drawCar(player) {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, carWidth, carHeight);
    }

    function drawObstacle(ob) {
      ctx.fillStyle = ob.type === "slow" ? "blue" : "red";
      ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    }

    function createObstacle() {
      const x = Math.random() * (canvas.width - 50);
      const type = Math.random() < 0.5 ? "slow" : "slide";
      obstacles.push({ x, y: -60, width: 50, height: 50, type });
    }

    function movePlayer(p, up, down, left, right) {
      if (keys[left] && p.x > 0) p.x -= p.speed;
      if (keys[right] && p.x < canvas.width - carWidth) p.x += p.speed;
      if (keys[up] && p.y > 0) p.y -= p.speed;
      if (keys[down] && p.y < canvas.height - carHeight) p.y += p.speed;
    }

    function checkCollision(p) {
      for (let ob of obstacles) {
        if (
          p.x < ob.x + ob.width &&
          p.x + carWidth > ob.x &&
          p.y < ob.y + ob.height &&
          p.y + carHeight > ob.y
        ) {
          if (ob.type === "slow") {
            slowTimer = 60;
          } else if (ob.type === "slide") {
            slideTimer = 60;
          } else {
            endGame();
          }
        }
      }
    }

    function update() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (mode >= 1) movePlayer(player1, "w", "s", "a", "d");
      if (mode === 2) movePlayer(player2, "ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight");

      if (slideTimer > 0) {
        player1.x += Math.random() > 0.5 ? 3 : -3;
        if (mode === 2) player2.x += Math.random() > 0.5 ? 3 : -3;
        slideTimer--;
      }

      if (slowTimer > 0) {
        player1.speed = 2;
        if (mode === 2) player2.speed = 2;
        slowTimer--;
      } else {
        player1.speed = 5;
        if (mode === 2) player2.speed = 5;
      }

      drawCar(player1);
      if (mode === 2) drawCar(player2);

      for (let ob of obstacles) {
        ob.y += difficulty;
        drawObstacle(ob);
      }

      checkCollision(player1);
      if (mode === 2) checkCollision(player2);

      obstacles = obstacles.filter(o => o.y < canvas.height);

      if (Math.random() < 0.03) createObstacle();

      ctx.fillStyle = "white";
      ctx.fillText("Pontos: " + score, 10, 20);
      score++;
      if (score % 500 === 0 && difficulty < 10) difficulty++;

      if (score >= 5000) {
        endGame(true);
      }

      if (gameRunning) requestAnimationFrame(update);
    }

    function loop() {
      update();
    }

    function endGame(won = false) {
      gameRunning = false;
      gameOver = true;
      setTimeout(() => {
        alert(won ? "Você venceu! 🏆" : "Você perdeu! 😢");
        document.getElementById("menu").classList.remove("hidden");
        canvas.classList.add("hidden");
      }, 100);
    }

    window.addEventListener("keydown", (e) => (keys[e.key] = true));
    window.addEventListener("keyup", (e) => (keys[e.key] = false));
  </script>
</body>
</html>
